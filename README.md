# Creating Embeddings and Recognizing Fonts using Tensorflow


## File structure/files
* This repository holds the codes to train the neural network and produce the embeddings. The embeddings can be used to recognize fonts. The embeddings will be used in https://github.com/ericschulman/fonts_causal_analysis for causal economic analyses. This repository should have external folders with the data. Here is an example of folder structure under a name "fonts_project."

```
fonts_project    
└───datasets
│   └─── New Pangram 2
│   └─── UT research project datasets
│   │   │ Style Sku Family.csv
└───models
└───logs
└───fontnet
```

* We run the code in this repository using anacondas with python 3.7 on Ubuntu 18.03. For tensorflow, version 1.7 or better is required.
`conda install tensorflow`

## Preprocessing 

Run `preprocessing.sh`. This should create the necessary cropped data from original pangram bmp images. 

## Training

Run `train.sh`. We trained until the loss function is between .6-.8. Results may vary. It took me about 36 hours on relatively weak hardware, i.e., I5-6260U CPU @ 1.80GHz × 4 and 16 GB RAM. 

## Cross-validation


First run `gen_pairs.sh`. This should create the necessary data for cross-validation. The `pairs.txt` files will appear in the folder with the test data. There are 2 sets:
* Easy, this is generated by specifying `diff_style` 0.
* Hard, this is generated by specifying `diff_style` 1. We test whether the font is trained to recognize font families and not just styles.  

Then run `validate.sh`. This should display statistics about the trained model. You will need to specify the model and log directory. This is generated by training a model.


## Saving the embeddings

Run `write_embeddings.sh`.  You will need to specify the model and log directory. This is generated by training a model. The result of this script will appear in the `UT research project datasets` folder. Without modifying the code, the file will be called `embeddings_full.csv`.
